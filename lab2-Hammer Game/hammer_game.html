<!DOCTYPE html>
<html>

<head>
    <title>Hammer Game!</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
        let timeRemaining = 3;          // Amount of time remaining for the countdown

        let timeToShowMonster = 2000;   // Amount of time to show the monster
        let timeToHideMonster = 2000;   // Amount of time to hide the monster

        let hideMonsterTimeout;         // Timeout id for hiding the monster

        let life = 3;                   // The player's life

        // ========== Debugging function
        let lastTimestamp = Date.now();
        function _debugTimestamp(name) {
            const currentTimestamp = Date.now();
            const timeElapsed = currentTimestamp - lastTimestamp;
            // console.log(`${name} | Time Elapsed: ${timeElapsed}ms | Timestamp: ${currentTimestamp}`);
            console.log(`${name} | Time Elapsed: ${timeElapsed}ms`);
            lastTimestamp = currentTimestamp;
        }

        const isGameOver = () => { return life <= 0; }

        function hideMonster() {
            _debugTimestamp("hideMonster()");

            // Change the life and the colour of the holes
            if (isGameOver()) return;

            life--;
            if (life === 2) {
                $(".hole").css("border-color", "yellow");
            } else if (life === 1) {
                $(".hole").css("border-color", "red");
            }

            // If the game is over show the game over screen
            if (life === 0) {
                $("#gameover").fadeIn();
                return;
            }
            // Hide the monster
            $("#monster").hide();

            // Show the monster later again (= show after hide time)
            setTimeout(showMonster, timeToHideMonster);
        }

        function showMonster() {
            _debugTimestamp("showMonster()");

            // Find the target div randomly and move the monster
            // to that div
            const randomIndex = Math.floor(Math.random() * $(".hole").length);
            const targetHole = $(".hole").eq(randomIndex);
            $("#monster").appendTo(targetHole);

            // Show the monster
            $("#monster").show();

            // Hide the monster later (= after show time)
            hideMonsterTimeout = setTimeout(hideMonster, timeToShowMonster);
        }

        function startGame() {
            _debugTimestamp("startGame()");
            // Hide the countdown timer
            $("#countdown").fadeOut(500);

            // Show the monster the first time
            setTimeout(showMonster, timeToShowMonster);

            // Set up the click handler of the monster
            $("#monster").on("click", function () {
                if (isGameOver()) return;

                _debugTimestamp("#Monster onClick()!");

                // - Clear the previous timeout
                clearTimeout(hideMonsterTimeout);

                // - Hide the monster
                $("#monster").hide();

                // - Adjust the monster time (min time 500ms)
                timeToShowMonster = Math.max(500, timeToShowMonster - 100);
                timeToHideMonster = Math.max(500, timeToHideMonster - 100);
                console.log(`New times: show ${timeToShowMonster}ms, hide ${timeToHideMonster}ms`);

                // timeToShowMonster -= 100;
                // timeToHideMonster -= 100;

                // - Show the monster later again (= show after hide time)
                setTimeout(showMonster, timeToHideMonster);
            });
        }

        function countdown() {
            _debugTimestamp("countdown()");

            // Decrease the remaining time
            timeRemaining--;

            if (timeRemaining > 0) {
                // Continue the countdown if there is still time;
                $("#countdown").text(timeRemaining);
                setTimeout(countdown, 1000);
            } else {
                // otherwise, start the game when the time is up
                $("#countdown").text("Start");
                startGame();
            }
        }

        $(function () {
            _debugTimestamp("countdown()");
            // Start the countdown screen
            setTimeout(countdown, 1000);
        });
    </script>

    <!-- This is the font returned from Google font -->
    <link href="https://fonts.googleapis.com/css2?family=Gloria+Hallelujah&display=swap" rel="stylesheet">

    <style>
        /* This is the style of the body element */
        body {
            font-family: 'Gloria Hallelujah', cursive;
            margin: 0;
            padding: 0;
            background: white url(clown.png);
        }

        /* Set the common style for the countdown and gameover divs */
        #countdown,
        #gameover {
            position: absolute;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            padding: 0;
            text-align: center;
            font-size: 20vh;
            line-height: 100vh;
            background-color: rgba(0, 0, 0, 0.8);
        }

        /* - Set the properties for the countdown div */
        #countdown {
            color: yellow;
        }

        /* - Set the properties for the gameover div */
        #gameover {
            color: red;
            display: none;
        }

        /* Set the style of the game area */
        #game-area {
            width: 90vmin;
            height: 90vmin;
            margin: 5vmin auto;
        }

        /* - Set the style of the holes */
        .hole {
            float: left;

            width: 24vmin;
            height: 24vmin;
            margin: 2vmin;
            background: black;

            box-sizing: border-box;
            border: 1vmin solid green;
            border-radius: 10%;

            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* - Set the style of the monster image */
        #monster {
            width: 80%;
            height: auto;
            display: none;
        }
    </style>
</head>

<body>
    <!-- This div contains all holes -->
    <div id="game-area">
        <div class="hole">
            <!-- This is the monster -->
            <img id="monster" src="nomore.png" alt="Nomore monster">
        </div>
        <div class="hole"></div>
        <div class="hole"></div>
        <div class="hole"></div>
        <div class="hole"></div>
        <div class="hole"></div>
        <div class="hole"></div>
        <div class="hole"></div>
        <div class="hole"></div>
    </div>

    <!-- The countdown screen -->
    <div id="countdown">3</div>

    <!-- The gameover screen -->
    <div id="gameover">Game Over</div>
</body>

</html>